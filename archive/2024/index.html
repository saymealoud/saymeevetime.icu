
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Chester Zhao">
      
      
      
        <link rel="prev" href="../../category/word1/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.14">
    
    
      
        <title>2024 - saymealoud</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.10ba22f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2024" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="saymealoud" class="md-header__button md-logo" aria-label="saymealoud" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-6 8h-2V9h2v2m0-4h-2a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2v2H9v2h4a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            saymealoud
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2024
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/saymealoud/saymeevetime.icu" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    saymealoud/saymeevetime.icu
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="saymealoud" class="md-nav__button md-logo" aria-label="saymealoud" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-6 8h-2V9h2v2m0-4h-2a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2v2H9v2h4a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Z"/></svg>

    </a>
    saymealoud
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/saymealoud/saymeevetime.icu" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    saymealoud/saymeevetime.icu
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/book/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    book
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/life/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    life
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/tech/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tech
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/word1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    word1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2024">2024</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/saymealoud.png" alt="Chester Zhao">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-03-22 00:00:00">March 22, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/tech/" class="md-meta__link">tech</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="rabbitmq"><a class="toclink" href="../../rabbitmq/">RabbitMQ</a></h2>
<p>消息真的发送出去了吗?</p>
<ul>
<li>消息发送后,发送端不知道Rabbit MQ 是否真的收到了消息</li>
<li>若 Rabbit MQ 异常,消息丢失后,订单处理流程停止,业务异常</li>
<li>需要使用Rabbit MQ 发送端确认机制, 确认消息发送</li>
</ul>
<p>消息真的被路由了吗?</p>
<ul>
<li>消息发送后,发送端不知道消息是否被正确路由, 若路由异常,消息会被丢弃</li>
<li>消息丢弃后,订单处理流程停止,业务异常</li>
<li>需要使用 Rabbit MQ 消息返回机制, 确认消息被正确路由</li>
</ul>
<p>队列饱满怎么办?</p>
<ul>
<li>默认情况下,消息进入队列,会永远存在,直到被消费</li>
<li>大量堆积的消息会给Rabbit MQ 产生很大的压力</li>
<li>需要使用 Rabbit MQ 消息过期时间,  防止消息大量积压</li>
</ul>
<p>如何转移过期消息</p>
<ul>
<li>消息被设置了过期时间,过期后会直接被丢弃</li>
<li>直接被丢弃的消息,无法对系统运行异常发出警报 </li>
<li>需要使用 Rabbit MQ <strong>死信队列</strong> ,收集过期消息,以供分析</li>
</ul>
<p>目前需要处理:</p>
<ol>
<li>发送端确认</li>
<li>消息返回</li>
<li>消费端限流</li>
<li>消费端确认</li>
<li>消息过期机制</li>
<li>死信队列</li>
</ol>
<p>实际开发经验</p>
<ol>
<li>线程池    溢出  线程爆炸</li>
<li>POJO    类 单一职责</li>
</ol>
<p>发送方</p>
<ul>
<li>需要使用 Rabbit MQ <strong>发送端确认机制,</strong>确认消息成功发送到 Rabbit MQ 并被处理</li>
<li>需要使用Rabbit MQ  <strong>消息返回机制</strong>, 若没发现目标队列, 中间件会通知发送方</li>
</ul>
<p>消费方</p>
<ul>
<li>需要使用 Rabbit MQ <strong>消费端确认机制</strong>,  确认消息没有发生处理异常</li>
<li>需要使用 Rabbit MQ  <strong>消费端限流机制</strong>, 限制消息推送速度, 保障接收端服务稳定</li>
</ul>
<p>Rabbit MQ 自身</p>
<ul>
<li>大量堆积的消息会给 Rabbit MQ  产生很大的压力, 需要使用 Rabbit MQ <strong>消息过期时间</strong>,防止消息大量积压</li>
<li>过期后会直接丢弃, 无法对系统运行异常发出警报, 需要使用 Rabbit MQ  <strong>死信队列</strong> , 收集过期消息,以供分析</li>
</ul>
<p>消息真的发出去了吗?</p>
<ul>
<li>消息发送后, 发送端不知道 Rabbit MQ 是否真的收到了消息</li>
<li>若 Rabbit MQ异常 , 消息丢失后, 订单处理流程停止, 业务异常</li>
<li>需要使用 Rabbit MQ <strong>发送端确认机制</strong>, 确认消息发送</li>
</ul>
<p>什么是发送端确认机制</p>
<ul>
<li>消息发送后, 若中间件收到消息,会给发送端一个应答</li>
<li>生产者,接收应答,用来确认这条消息是否正常发送到中间件</li>
</ul>
<p>三种确认机制</p>
<ul>
<li>单条同步确认</li>
<li>配置 Channel ,开启确认模式: channel.confirmSelect()</li>
<li>每发送一条消息,调用 channel.waitForConfirms()方法,等待确认</li>
<li>多条同步确认 (不推荐)</li>
<li>配置 Channel ,开启确认模式: channel.confirmSelect()</li>
<li>发送多条消息,调用 channel.waitForConfirms()方法,等待确认 </li>
<li>异步确认 (不推荐)</li>
<li>配置 Channel ,开启确认模式: channel.confirmSelect()</li>
<li>在channel 上添加监听: addConfirmListener, 发送消息后,会回调此方法,通知是否发送成功</li>
<li>异步确认有可能是单条, 也有可能是多条,取决于 MQ</li>
</ul>
<p>消息真的被路由了吗</p>
<ul>
<li>消息发送后,发送端不知道消息是否被正确路由,若路由异常,消息会被丢弃</li>
<li>消息丢弃后,订单处理流程停止,业务异常</li>
<li>需要使用 Rabbit MQ <strong>消息返回机制</strong>, 确认消息被正确路由</li>
</ul>
<p>消息返回机制的原理</p>
<ul>
<li>消息发送后,中间件会对消息进行路由</li>
<li>若没有发现目标队列, 中间件会通知发送方</li>
<li>Return Listener 会被调用</li>
</ul>
<p>消息返回的开启方法</p>
<ul>
<li>在 Rabbit MQ 基础配置中有一个关键配置项 : Mandatory </li>
<li>Mandatory 若为false, Rabbit MQ 将直接丢弃无法路由的消息</li>
<li>Mandatory 若为 true , Rabbit MQ 才会处理无法路由的消息</li>
</ul>
<p>消费端确认机制</p>
<ul>
<li>默认情况下,消费端接收消息时,消息会被自动确认 (ACK)</li>
<li>消费端处理消息异常时,发送端与消息中间件无法得知消息处理情况</li>
<li>需要使用 Rabbit MQ <strong>消费端确认机制</strong>, 确认消息被正确处理</li>
</ul>
<p>消费端 ACK 类型</p>
<ul>
<li>自动 ACK : 消费端收到消息后, 会自动签收消息</li>
<li>手动 ACK: 消费端收到消息后, 不会自动签收消息, 需要我们在业务代码中显式签收消息</li>
<li>单条手动 ACK : multiple = false (<strong>推荐</strong>)</li>
<li>多条手动 ACK : multiple = true</li>
</ul>
<p>重回队列</p>
<ul>
<li>若设置了重回队列, 消息被 NACK后, 会返回队列末尾,等待进一步处理</li>
<li>一般不建议开启重回队列,因为第一次处理异常的消息,再次处理,基本上也是异常</li>
</ul>
<p>消费端限流机制</p>
<ul>
<li>业务高峰期,可能出现发送端与接收端性能不一致,大量消息被同时推送给接收端,造成接收端服务崩溃</li>
<li>需要使用 Rabbit MQ <strong>消费端限流机制</strong>, 限制消息推送速度,保障接收端服务稳定</li>
</ul>
<p>实际场景</p>
<ul>
<li>业务高峰期,有个微服务崩溃了,崩溃期间队列积压了大量消息,微服务上线后,收到大量并发消息</li>
<li>将同样多的消息推给能力不同的副本,会导致部分副本异常</li>
</ul>
<p>Rabbit MQ   QoS</p>
<ul>
<li>针对上面问题,  Rabbit MQ 开发了 QoS (服务质量保证)功能</li>
<li>QoS 功能保证了在一定数目的消息未被确认前,不消费新的信息</li>
<li>Qos 功能的前提是不使用自动确认</li>
</ul>
<p>QoS 原理</p>
<ul>
<li>QoS 原理是当消费者有一定数量的消息未被 ACK 确认时, Rabbit MQ 不给消费端推送新的消息</li>
<li>Rabbit MQ 使用 QoS 机制实现了消费端限流</li>
</ul>
<p>消费端限流机制参数设置</p>
<ul>
<li>prefetchCount:  针对消费端最多推送多少未确认消息</li>
<li>global: true : 针对整个消费端限流 false : 针对当前 channel </li>
<li>prefetchSize: 0 (单个消息大小限制, 一般为 0)</li>
<li>prefetchSize 与 global 两项, Rabbit MQ 暂时未实现</li>
</ul>
<p>消息过期机制</p>
<p>队列饱满怎么办?</p>
<ul>
<li>默认情况下,消息进入队列,会永远存在,直到被消费</li>
<li>大量堆积的消息回给 Rabbit MQ 产生很大的压力</li>
<li>需要使用 Rabbit MQ <strong>消息过期时间</strong>,防止消息大量积压</li>
</ul>
<p>Rabbit MQ的 过期时间 (TTL)</p>
<ul>
<li>Rabbit MQ 的过期时间称为  TTL </li>
<li>Rabbit MQ 过期时间分为 消息 TTL 和 队列 TTL</li>
<li>消息TTL 设置了消息的单条过期</li>
<li>队列 TTL 设置了队列中所有消息的过期时间  (如果之前已经定义了队列那就要删除,不然会设置 TTL 启动会报错)</li>
</ul>
<p>如何找到自己合适的 TTL?</p>
<ul>
<li>TTL  设置主要考虑技术架构与业务</li>
<li>TTL 应该明显长于服务的平均重启时间</li>
<li>建议 TTL 长于业务高峰期时间</li>
</ul>
<p>死信队列</p>
<p>如何转移过期消息?</p>
<ul>
<li>消息设置了过期时间,过期后会直接丢弃</li>
<li>直接丢弃的消息,无法对系统运行异常发出警报</li>
<li>需要使用 Rabbit MQ 私信队列, 收集过期消息,以供分析</li>
</ul>
<p>什么是死信队列</p>
<ul>
<li>死信队列: 队列配置了 DLX 属性(Dead-Letter-Exchange)</li>
<li>当一个消息变成死信(dead message )后, 能重新被发布到另一个 Exchange,这个 Exchange 也是一个普通的交换机</li>
<li>死信被死信交换机路由后, 一般进入一个固定队列</li>
</ul>
<p>怎么变成死信</p>
<ul>
<li>消息被拒绝 (reject/nack) 并且 requeue = false</li>
<li>消息过期 (TTL 到期)</li>
<li>队列达到最大长度</li>
</ul>
<p>死信队列设置方法</p>
<ul>
<li>设置转发、接收死信的交换机和队列:</li>
<li>Exchange: dlx.exchange</li>
<li>Queue: dlx.queue</li>
<li>RoutingKey: #</li>
<li>在需要设置死信的队列加入参数:</li>
<li>X-dead-letter-exchange =dlx.exchange</li>
</ul>
<p>summary</p>
<p>慎用Rabbit MQ 高级特性</p>
<ul>
<li>不要无限追求高级,用 Rabbit MQ的高级特性</li>
<li>重回队列、发送端确认是不常用的特性,谨慎使用</li>
<li>管控台是 调试 Rabbit MQ的利器</li>
<li>Rabbit MQ高级特性多数涉及交换机、队列的属性配置,可以在管控台确认配置是否生效</li>
<li>Rabbit MQ 高级特性很多都可以在管控台进行实验</li>
</ul>
<p>总结</p>
<ul>
<li>为了确保消息发送,使用了发送端确认机制</li>
<li>为了确保消息正确路由,使用了消息返回机制</li>
<li>为了保证消息正常梳理,使用了消费端确认机制</li>
<li>为了保证消费端稳定,使用消费端限流机制</li>
<li>为了中间件问题,使用过期时间机制</li>
<li>为了处理异常消息,使用死信机制</li>
</ul>
<p>引入 Spring Boot 的重要性 </p>
<ol>
<li>易用的 Rabbit MQ 连接方式</li>
<li>方便的 Rabbit MQ配置方式</li>
<li>提供了完善的消息收发方式</li>
</ol>
<p>Spring AMQP 特性</p>
<ul>
<li>异步消息监听容器</li>
<li>原始实现: 自己实现线程池、回调方法,并注册回调方法</li>
<li>Spring Boot: 自动实现可配置的线程池,并自动注册回调方法,只需实现回调方法</li>
<li>原生提供 RabbitTemplate , 方便收发消息</li>
<li>相比 basicPublish, 功能更强大,能自动实现消息转换等功能</li>
<li>原生提供 RabbitAdmin ,方便队列、交换机声明</li>
<li>声明式提供队列、交换机、绑定关系的注册方法</li>
<li>设置不需要显式的注册代码</li>
<li>Spring Boot Config  原生支持 Rabbit MQ </li>
<li>充分发挥 Spring Boot 约定大于配置的特性</li>
<li>可以隐式建立 Connection、Channel</li>
</ul>
<p>RabbitAdmin</p>
<ul>
<li>
<p>管理 Rabbit MQ</p>
</li>
<li>
<p>declareExchange : 创建交换机</p>
</li>
<li>deleteExchange: 删除交换机</li>
<li>declareQueue: 创建队列</li>
<li>deleteQueue : 删除队列</li>
<li>purgeQueue: 清空队列</li>
<li>declareBinding: 新建绑定关系</li>
<li>removeBinding:  删除绑定关系</li>
<li>
<p>getQueueProperties: 查询队列属性</p>
</li>
<li>
<p>创建方法</p>
</li>
</ul>
<div class="language-java highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">ConnectionFactory</span><span class="w"> </span><span class="n">connectionFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CachingConnectionFactory</span><span class="p">();</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">RabbitAdmin</span><span class="w"> </span><span class="n">rabbitAdmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RabbitAdmin</span><span class="p">(</span><span class="n">connectionFactory</span><span class="p">);</span>
</span></code></pre></div>
<p>RabbitAdmin 声明式配置</p>
<ul>
<li>将Exchange、Queue、Binding 声明为 Bean</li>
<li>再将 RabbitAdmin 声明为  Bean</li>
<li>Exchange、Queue、Binding 即可自动创建</li>
</ul>
<p>RabbitAdmin  声明式配置的优点</p>
<ul>
<li>将声明和创建工作分开,解耦多人工作</li>
<li>不需要显式声明,减少代码量,减少bug</li>
</ul>
<p>RabbitTemplate</p>
<ul>
<li>RabbitTemplate 与 RestTemplate 类似,使用了模版方法设计模式</li>
<li>RabbitTemplate 提供了丰富的功能,方便消息收发</li>
<li>RabbitTemplate 可以显式传入配置也可以隐式声明配置</li>
</ul>
<p>SimpleMessageListenerContainer 高效监听消息</p>
<ul>
<li>设置同时监听多个队列、自动启动、自动配置Rabbit MQ</li>
<li>设置消费者数量 (最大数量、最小数量、批量消费)</li>
<li>设置消息确认模式、是否重回队列、异常捕获</li>
<li>设置是否独占、其他消费者属性等</li>
<li>设置具体的监听器、消息转换器等</li>
<li>支持动态设置,运行中修改监听器配置</li>
</ul>
<p>MessageListenerAdapter 消息监听适配器</p>
<ul>
<li>适配器设计模式</li>
<li>解决业务逻辑代码无法修改的问题</li>
</ul>
<p>MessageConverter</p>
<ul>
<li>
<p>收发消息,使用 Byte[] 数组作为消息体</p>
</li>
<li>
<p>编写业务逻辑时,需要使用 Java 对象</p>
</li>
<li>
<p>MessageConverter 用来在接收消息时自动转换消息</p>
</li>
</ul>
<p>Jackson2JsonMessageConverter</p>
<ul>
<li>最常用的 MessageConverter ,用来转换 Json 格式信息</li>
<li>配合 ClassMapper 可以直接转换为 POJO 对象 </li>
</ul>
<p>RabbitListener </p>
<ul>
<li>RabbitListener 是 SpringBoot 架构中监听消息的“终极方案”</li>
<li>RabbitListener 使用注解声明,对业务代码无侵入</li>
<li>RabbitListener 可以在 Springboot  配置文件中进行配置</li>
</ul>
<p>@RabbitListener 注解</p>
<ul>
<li>@RabbitListener 是一个组合注解,可以嵌套以下注解</li>
<li>@Exchange : 自动声明Exchange</li>
<li>@Queue : 自动声明队列</li>
<li>@QueueBinding: 自动声明绑定关系</li>
</ul>
<p>Rabbit 容量不足</p>
<ul>
<li>受制于服务器、虚机、容器的规模,单节Rabbit MQ容量受限</li>
<li>在业务量庞大时,单节点MQ可能会因为内存不足导致 OOM</li>
</ul>
<p>Rabbit MQ 数据无副本</p>
<ul>
<li>单节点 Rabbit MQ 没有备份数据</li>
<li>若单节点故障, 消息数据丢失</li>
</ul>
<p>Rabbit MQ 可用性低</p>
<ul>
<li>单节点 Rabbit MQ 不可避免会出现故障</li>
<li>单节点故障后, Rabbit MQ 服务不可用,系统业务崩溃</li>
</ul>
<p>单节点:</p>
<ol>
<li>规模不大 OOM</li>
<li>数据安全</li>
<li>可用性</li>
</ol>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/saymealoud.png" alt="Chester Zhao">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-03-14 00:00:00">March 14, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/book/" class="md-meta__link">book</a></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="spring-boot-mercyblitz"><a class="toclink" href="../../spring-boot-%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3---mercyblitz/">Spring Boot 编程思想 - mercyblitz</a></h2>
<p>Spring Boot  2013 问世, 微服务架构 Martin Fowler  等人 2014 提出</p>
<p>IOC  DI  颠覆 J2EE 开发模式</p>
<p>“胶水框架”   </p>
<p>AOP 切面 使得 事物编程简化   Spring  Web  MVC</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Spring Framework 接口怎么简化, 设计如何优美,始终无法摆脱被动情况---- 自身并非容器, 不得不随Java EE 容器启动才能加载, Spring Boot  的出现, 改变了 Spring Framework 乃至整个 Spring 技术体系的现状
</span></code></pre></div>
<ul>
<li>Create stand-alone Spring applications</li>
<li>Embed Tomcat, Jetty or Undertow directly (no need to deploy WAR files)</li>
<li>Provide opinionated 'starter' dependencies to simplify your build configuration</li>
<li>Automatically configure Spring and 3rd party libraries whenever possible</li>
<li>Provide production-ready features such as metrics, health checks, and externalized configuration</li>
<li>
<p>Absolutely no code generation and no requirement for XML configuration</p>
</li>
<li>
<p>创建独立的 Spring 应用程序 直接嵌入 Tomcat、Jetty 或 Undertow（无需部署 WAR 文件）</p>
</li>
<li>提供固化的 “starter” 依赖项以简化构建配置 </li>
<li>当条件满足时自动装配 Spring 或第三方类库 </li>
<li>提供运维 (production-ready)特性，如指标信息(Metrics )、健康检查及外部化配置 </li>
<li>绝无生成代码，并且不需要 XML 配置</li>
</ul>
<h3 id="chapter-6"><a class="toclink" href="../../spring-boot-%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3---mercyblitz/#chapter-6">Chapter 6</a></h3>
<h5 id="_1"><a class="toclink" href="../../spring-boot-%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3---mercyblitz/#_1">约定大于配置</a></h5>
<blockquote>
<p>"Absolutely no code generation and no requirement for XML configuration"</p>
</blockquote>
<p>Spring Boot 重回 main 方法的启动方式,让自己找到了初学 Java 时的记忆,尽管不少人的开发模式习惯以XML文件配置启动,在逐渐转化为注解驱动的过程,以为注解驱动时Spring Boot引入的,说明了Spring Boot 与 Spring Framework 的关系是 “你中有我,我中有你”</p>

<p>从技术的角度来叙述,Spring Framework 是Spring Boot的“基础设施” Spring Boot 的基本特性均来自 Spring Framework.Spring Boot不但无法取代 Spring Framework ,还实现了 Spring Framework 的"自我救赎". </p>

<p>从Spring Framework 2.5 开始, Spring Bean 注册方式由 Annotation 驱动逐步替代 XML 文件驱动, 通过  <strong>@Component</strong>  及 “派生” 注解 (<strong>@Service</strong>) 与 XML 元素 <code>context:component-scan base-package="..."</code> 互相配合,将 Spring <strong>@Component</strong> Bean 扫描并注册至 Spring Bean 容器 (BeanFactory), 通过 DI 注解<strong>@Autowired</strong> 获取相应的Spring 组件 Bean. 然而 <strong>@Component</strong> Bean 必须在 <code>context:component-scan</code> 规定的<code>base-package</code> 集合范围中.</p>
<p>到了 Spring Framework  3.0 时代,新引入的 Annotation @Configuration 是 XML 配置文件的替代物. 而 Bean 的定义不在需要在 XML 文件中声明 <Bean> 元素  可使用 @Bean 来代替.同时,框架提供了更细粒度的  Annotation @Import 来倒入 @Configuration Class ,将其注册为 Spring Bean,并进一步解析其声明的 Spring Bean 注册相关的注解, 如 @Import 或 @Bean.尽管在 Bean 的装配方面有明显提升, 但是仍是以硬编码的方式指定范围  </p>

<p>当 Spring Framework 3.1 发布后, 虽说 3.0 到 3.1 不过是小版本的变化,然而其实际更新动作并不小, 此时的 Spring 注解才完全取代 XML 配置文件,引入 Annotation <strong>@ComponentScan</strong> 来代替 XML 元素 <code>context:component-scan</code>  , 初看起来并没有多少提升.应用方可以实现 ImportSelector 接口 (实现 selectImports(AnnotationMetadata)方法),程序动态地决定哪些 Spring  Bean 需要被导入. 可是 ImportSelector  实现类必须暴露成 Spring Bean,否则  selectImports(AnnotationMetadata)方法) 不会被 Spring 容器调用, 为了简化实现成本, Spring Framework  3.1 内建了不少的功能 “模块” 激活的注解, 如 @EnableCache.即便如此,被标注 <strong>@EnableCache</strong> 的类同样需要通过 <strong>@ComponentScan</strong> 或 <strong>@Import</strong> 等方式被 Spring 容器感知, 这就又成了 “先有鸡还是先有蛋”的问题.硬编码的问题得到了缓解,但仍然与自动装配的能力相去甚远.</p>
<p>Spring Framework 到了 4.0 版本增加了条件化的 Spring Bean 装配注解 <strong>@Conditional</strong> , 其 value() 属性可指定 Condition 的实现类, 而 Condition 提供装配条件的实现逻辑,  <strong>@Conditional</strong> 的引入更直观表达了 Spring Bean 装载时所需的前置条件.或许 Spring Boot 官方对自动化装配的后半段描述容易让人忽视-------“ whenever possible ” 正因为 Spring Framework 条件注解 <strong>@Conditional</strong> 的引入,使得条件装配成为可能, Spring Boot 在此基础上, 实现了最显著特性之一-----<strong>条件化自动装配</strong>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/saymealoud.png" alt="Chester Zhao">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-03-05 00:00:00">March 5, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/life/" class="md-meta__link">life</a></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="find-job"><a class="toclink" href="../../find-job/">Find job</a></h2>
<h4 id="_1"><a class="toclink" href="../../find-job/#_1">结束深漂</a></h4>
<p>回到西安,开始找工作,稳定发展</p>
<p>2024.03.05 
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="err">目前</span><span class="w">  </span><span class="err">投寄两家</span><span class="w">  </span><span class="err">暂无面试</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="err">面试一家</span><span class="w">   </span><span class="mi">25</span><span class="err">分钟</span><span class="w"> </span><span class="mi">2024</span><span class="p">.</span><span class="mi">03</span><span class="p">.</span><span class="mi">07</span><span class="w"> </span><span class="mi">14</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="err">面试</span>
</span></code></pre></div>
最近心里好乱  一天天感觉很舒服  但是想与人理性交流</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/saymealoud.png" alt="Chester Zhao">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-03-04 00:00:00">March 4, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/tech/" class="md-meta__link">tech</a></li>
        
        
          
          <li class="md-meta__item">
            
              7 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="xxx-job"><a class="toclink" href="../../xxx-job/">Xxx job</a></h2>
<h4 id="xxl-jobspringboot"><a class="toclink" href="../../xxx-job/#xxl-jobspringboot">第一章 新版分布式调度XXL-Job+SpringBoot课程介绍</a></h4>
<h5 id="1-xxl-jobspringboot"><a class="toclink" href="../../xxx-job/#1-xxl-jobspringboot">第1集 新版分布式调度XXL-Job+SpringBoot实战专题课程介绍</a></h5>
<p><strong>简介：分布式调度XXL-Job介绍-适合人员和学后水平</strong></p>
<ul>
<li>课程介绍</li>
<li>
<p>本套课程 是<strong>全新录制，</strong>从0到1讲解新版分布式调度XXL-Job核心基础+<strong>高级知识点。</strong></p>
</li>
<li>
<p>不止讲解新版XXL-Job核心知识 ，横向对比多个业界解决方案，源码部署分布式调度XXL-Job，讲解控制台各个模块知识点，使用SpringBoot整合XXL-Job实战，多节点执行器和调度策略实战，命令行参数传递和日志配置</p>
</li>
<li>
<p>【高级部分】XXL-Job集群部署和架构链路讲解，海量任务调度解决方案分片广播讲解和实战</p>
</li>
<li>
<p>为什么要学习分布式调度XXL-Job</p>
</li>
<li>XXL-JOB是一个分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展</li>
<li>多数互联网公司里面用的技术，周期性业务 如<strong>消息推送、支付对账、数据统计</strong>等，离不开分布式调度</li>
<li>在多数互联网公司中，分布式调度XXL-Job占有率很高，是近几年大量流行</li>
<li>可以作为公司内部培训技术分享必备知识，超多案例+实战等</li>
<li>
<p>有谁在用</p>
<ul>
<li>众多互联网大厂，包括并不限于虎牙、京东、荔枝FM、平安、360、网易 等 一二线大厂</li>
<li>https://www.xuxueli.com/</li>
</ul>
</li>
<li>
<p>课程技术栈和测试环境说明</p>
</li>
<li>
<p>JDk8或者JDK11 + SpringBoot + 源码部署 + IDEA+XXLJob2.3</p>
</li>
<li>
<p>技术不断更新，版本如何选择 </p>
<ul>
<li>中间件使用这块，不建议做第一个吃螃蟹的人</li>
<li>不同中间件，厂商不一样，不一定及时更新</li>
</ul>
</li>
<li>
<p>学后水平</p>
</li>
<li>
<p>掌握新版XXL-Job核心知识 ，横向对比多个业界解决方案</p>
</li>
<li>源码部署XXL-Job和控制台菜单模块功能点</li>
<li>掌握使用SpringBoot整合XXL-Job实战</li>
<li>掌握多节点执行器和调度策略实战，命令行参数传递和日志配置</li>
<li>【高级】XXL-Job集群部署和架构链路讲解</li>
<li>【高级】海量任务调度解决方案分片广播讲解和实战</li>
</ul>
<h5 id="2-xxl-jobspringboot"><a class="toclink" href="../../xxx-job/#2-xxl-jobspringboot">第2集 新版分布式调度XXL-Job+SpringBoot实战大纲速览</a></h5>
<p><strong>简介：新版分布式调度XXL-Job+SpringBoot实战大纲速览</strong></p>
<ul>
<li>课程学前基础</li>
<li>有Linux+SpringBoot就行，不会的话我们有专题课程学习,联系客服小姐姐即可</li>
<li>
<p>框架整合这块：采用SpringBoot框架（采用其他语言或框架也行）</p>
</li>
<li>
<p>目录大纲浏览</p>
</li>
</ul>
<h4 id="xxl-job"><a class="toclink" href="../../xxx-job/#xxl-job">第二章 急速认知分布式调度XXL-Job框架和源码安装</a></h4>
<h5 id="1"><a class="toclink" href="../../xxx-job/#1">第1集 你知道多少种定时任务的实现方式</a></h5>
<p><strong>简介：你知道多少种定时任务的实现方式</strong></p>
<ul>
<li>需求分析</li>
<li>在平常的业务场景当中，经常有一些场景需要使用到定时任务</li>
<li>比如说在某个时间点会发送优惠券、发送短信等等的一些业务操作，难道这些操作都需要人工来进行干预吗？</li>
<li>
<p>比如一些支付系统，需要在每天的凌晨1点来进行对前一天的清算，难道每次都要一个人来负责这个业务吗？</p>
</li>
<li>
<p>定时任务</p>
</li>
<li>通过时间表达式这一方式来进行任务调度的被称为定时任务</li>
<li>
<p>分类</p>
<ul>
<li>单机定时任务</li>
<li>单机的容易实现，但应用于集群环境做分布式部署，就会带来重复执行</li>
<li>解决方案有很多比如加锁、数据库等，但是增加了很多非业务逻辑</li>
<li>分布式调度（分布式定时任务）</li>
<li>把需要处理的计划任务放入到统一的平台，实现集群管理调度与分布式部署的定时任务 叫做分布式定时任务</li>
<li>支持集群部署、高可用、并行调度、分片处理等</li>
</ul>
</li>
<li>
<p>常见定时任务</p>
</li>
<li>单机：Java自带的java.util.Timer类配置比较麻烦，时间延后问题</li>
<li>单机：ScheduledExecutorService<ul>
<li>是基于线程池来进行设计的定时任务类，在这里每个调度的任务都会分配到线程池里的一个线程去执行该任务，并发执行，互不影响</li>
</ul>
</li>
<li>
<p>单机：SpringBoot框架自带</p>
<ul>
<li>SpringBoot使用注解方式开启定时任务</li>
<li>启动类里面 @EnableScheduling开启定时任务，自动扫描</li>
<li>定时任务业务类 加注解 @Component被容器扫描</li>
<li>定时执行的方法加上注解 @Scheduled(fixedRate=2000) 定期执行一次</li>
</ul>
</li>
<li>
<p>为什么需要任务调度平台</p>
</li>
<li>
<p>因为在传统的Java当中，传统的定时任务实现方案，像上述的Timer、Quartz等</p>
</li>
<li>
<p>它们都有不少缺点</p>
<ul>
<li>不支持集群、不支持统计、没有管理的平台、也没有报警、监控等等</li>
<li>在分布式架构当中，有一些场景是需要用到分布式的任务调度的，在同一个服务器中的多个实例任务之间存在着互斥，需要进行统一的调度，所以任务调度需要支持高可用、监控、故障告警等一系列措施。</li>
<li>需要统一管理和追踪各个的服务节点之间任务调度的结果，并保存记录任务信息等等</li>
</ul>
</li>
<li>
<p>如何解决上述问题？</p>
<ul>
<li>分布式调度平台</li>
</ul>
</li>
</ul>
<h5 id="2"><a class="toclink" href="../../xxx-job/#2">第2集 常见的分布式调度平台快速认知</a></h5>
<p><strong>简介：常见的分布式调度平台快速认知</strong></p>
<ul>
<li>
<p>常见分布式定时任务</p>
</li>
<li>
<p>Quartz</p>
<ul>
<li>Quartz关注点在于定时任务而并非是数据，并没有一套根据数据化处理而定的流程</li>
<li>虽然可以实现数据库作业的高可用，但是缺少了分布式的并行调度功能，相对弱点</li>
<li>不支持任务分片、没UI界面管理，并行调度、失败策略等也缺少</li>
</ul>
</li>
<li>
<p>TBSchedule</p>
<ul>
<li>这个是阿里早期开源的分布式任务调度系统，使用的是timer而不是线程池执行任务调度，使用timer在处理异常的时候是有缺陷的，但TBSchedule的作业类型比较单一，文档也缺失得比较严重</li>
<li>目前阿里内部使用的是ScheduleX</li>
<li>阿里云也有商业化版本: https://help.aliyun.com/product/147760.html</li>
</ul>
<p><img alt="image-20220519175053475" src="img/image-20220519175053475.png" /></p>
</li>
<li>
<p>Elastic-job</p>
<ul>
<li>当当开发的分布式任务调度系统，功能强大，采用的是zookeeper实现分布式协调，具有高可用与分片。</li>
<li>2020年6月，ElasticJob的四个子项目已经正式迁入Apache仓库</li>
<li>由 2 个相互独立的子项目 ElasticJob-Lite 和 ElasticJob-Cloud 组成</li>
<li>ElasticJob-Lite 定位为轻量级无中心化解决方案，使用jar的形式提供分布式任务的协调服务；</li>
<li>ElasticJob-Cloud 使用 Mesos 的解决方案，额外提供资源治理、应用分发以及进程隔离等服务</li>
<li>地址：https://shardingsphere.apache.org/elasticjob/index_zh.html</li>
</ul>
</li>
<li>
<p>XXL-JOB</p>
<ul>
<li>大众点评的员工徐雪里在15年发布的分布式任务调度平台，是轻量级的分布式任务调度框架，目标是开发迅速、简单、清理、易扩展; 老版本是依赖quartz的定时任务触发，在v2.1.0版本开始 移除quartz依赖</li>
<li>地址：https://www.xuxueli.com/xxl-job/</li>
</ul>
</li>
<li>
<p>常规对比图</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>对比项</th>
<th>XXL-JOB</th>
<th>elastic-job</th>
</tr>
</thead>
<tbody>
<tr>
<td>并行调度</td>
<td>调度系统多线程并行</td>
<td>任务分片的方式并行</td>
</tr>
<tr>
<td>弹性扩容</td>
<td>使用Quartz基于数据库分布式功能</td>
<td>通过zookeeper保证</td>
</tr>
<tr>
<td>高可用</td>
<td>通过DB锁保证</td>
<td>通过zookeeper保证</td>
</tr>
<tr>
<td>阻塞策略</td>
<td>单机串行/丢弃后续的调度/覆盖之前的调度</td>
<td>执行超过zookeeper的session timeout时间的话，会被清除，重新进行分片</td>
</tr>
<tr>
<td>动态分片策略</td>
<td>以执行器为维度进行分片、支持动态的扩容</td>
<td>平均分配/作业名hash分配/自定义策略</td>
</tr>
<tr>
<td>失败处理策略</td>
<td>失败告警/失败重试</td>
<td>执行完毕后主动获取未分配分片任务 服务器下线后主动寻找可以用的服务器执行任务</td>
</tr>
<tr>
<td>监控</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>日志</td>
<td>支持</td>
<td>支持</td>
</tr>
</tbody>
</table>
<ul>
<li>如何选择哪一个分布式任务调度平台</li>
<li>XXL-Job和Elastic-Job都具有广泛的用户基础和完善的技术文档，都可以满足定时任务的基本功能需求</li>
<li>xxl-job侧重在业务实现简单和管理方便，容易学习，失败与路由策略丰富, 推荐使用在用户基数相对较少，服务器的数量在一定的范围内的场景下使用</li>
<li>elastic-job关注的点在数据，添加了弹性扩容和数据分片的思路，更方便利用分布式服务器的资源, 但是学习难度较大，推荐在数据量庞大，服务器数量多的时候使用</li>
</ul>
<h5 id="3-xxl-job"><a class="toclink" href="../../xxx-job/#3-xxl-job">第3集 带你走近分布式调度XXL-Job核心特性</a></h5>
<p><strong>简介：带你走近分布式调度XXL-Job核心特性</strong></p>
<ul>
<li>
<p>什么是XXL-Job</p>
</li>
<li>
<p>XXL-JOB</p>
<ul>
<li>大众点评的员工徐雪里在15年发布的分布式任务调度平台，是轻量级的分布式任务调度框架，目标是开发迅速、简单、清理、易扩展; 老版本是依赖quartz的定时任务触发，在v2.1.0版本开始 移除quartz依赖</li>
<li>官网地址：https://www.xuxueli.com/xxl-job/</li>
<li>GitHub地址：https://github.com/xuxueli/xxl-job/</li>
</ul>
</li>
<li>
<p>xxl-job的设计思想</p>
<ul>
<li>将调度行为抽象形成“调度中心”公共平台，而平台自身并不承担业务逻辑，“调度中心”负责发起调度请求。</li>
<li>将任务抽象成分散的JobHandler，交由“执行器”统一管理</li>
<li>“执行器”负责接收调度请求并执行对应的JobHandler中业务逻辑。</li>
<li>因此，“调度”和“任务”两部分可以相互解耦，提高系统整体稳定性和扩展性</li>
</ul>
</li>
<li>
<p>架构图(图片来源是xxl-job官网)</p>
</li>
<li>
<p>调度中心</p>
<ul>
<li>负责管理调度的信息，按照调度的配置来发出调度请求</li>
<li>支持可视化、简单的动态管理调度信息，包括新建、删除、更新等，这些操作都会实时生效，同时也支持监控调度结果以及执行日志。</li>
</ul>
</li>
<li>
<p>执行器</p>
<ul>
<li>负责接收请求并且执行任务的逻辑。任务模块专注于任务的执行操作等等，使得开发和维护更加的简单与高效</li>
</ul>
</li>
<li>
<p>XXL-Job具有哪些特性</p>
</li>
<li>调度中心HA（中心式）：调度采用了中心式进行设计，“调度中心”支持集群部署，可保证调度中心HA</li>
<li>执行器HA（分布式）：任务分布式的执行，任务执行器支持集群部署，可保证任务执行HA</li>
<li>触发策略：有Cron触发、固定间隔触发、固定延时触发、API事件触发、人工触发、父子任务触发</li>
<li>路由策略：执行器在集群部署的时候提供了丰富的路由策略，如：第一个、最后一个、轮询、随机、一致性HASH、最不经常使用LFU、最久未使用LRU、故障转移等等</li>
<li>故障转移：如果执行器集群的一台机器发生故障，会自动切换到一台正常的执行器发送任务调度</li>
<li>Rolling实时日志的监控：支持rolling方式查看输入的完整执行日志</li>
<li>脚本任务：支持GLUE模式开发和运行脚本任务，包括Shell、python、node.js、php等等类型脚本</li>
</ul>
<h5 id="4-xxl-job"><a class="toclink" href="../../xxx-job/#4-xxl-job">第4集 分布式调度XXl-Job源码部署和数据库表建立《上》</a></h5>
<p><strong>简介：新版分布式调度XXl-Job源码部署和数据库表建立《上》</strong></p>
<ul>
<li>
<p>下载地址（版本和课程保证一致）</p>
</li>
<li>
<p>https://github.com/xuxueli/xxl-job/releases</p>
</li>
<li>
<p>版本V-2.3</p>
</li>
<li>
<p>源码（本章本集资料）</p>
</li>
<li>
<p>环境：IDEA旗舰版+Maven+JDK8或JDK11+Mysql5.7（本身就是SpringBoot项目）</p>
</li>
<li>
<p>目录介绍</p>
<ul>
<li>doc：xxl-job的文档资料，包括了数据库的脚本（后面要用到）</li>
<li>xxl-job-core：公共jar包依赖</li>
<li>xxl-job-admin：调度中心，项目源码，是Springboot项目，可以直接启动</li>
<li>xxl-job-executor-samples：执行器，是Sample实例项目，里面的Springboot工程可以直接启动，也可以在该项目的基础上进行开发，也可以将现有的项目改造成为执行器项目</li>
</ul>
</li>
<li>
<p>数据库（本章本集资料或者源码doc/db目录下）</p>
</li>
<li>
<p>xxl_job的数据库里有如下几个表</p>
<ul>
<li>xxl_job_group：执行器信息表，用于维护任务执行器的信息</li>
<li>xxl_job_info：调度扩展信息表，主要是用于保存xxl-job的调度任务的扩展信息，比如说像任务分组、任务名、机器的地址等等</li>
<li>xxl_job_lock：任务调度锁表</li>
<li>xxl_job_log：日志表，主要是用在保存xxl-job任务调度历史信息，像调度结果、执行结果、调度入参等等</li>
<li>xxl_job_log_report：日志报表，会存储xxl-job任务调度的日志报表，会在调度中心里的报表功能里使用到</li>
<li>xxl_job_logglue：任务的GLUE日志，用于保存GLUE日志的更新历史变化，支持GLUE版本的回溯功能</li>
<li>xxl_job_registry：执行器的注册表，用在维护在线的执行器与调度中心的地址信息</li>
<li>xxl_job_user：系统的用户表</li>
</ul>
</li>
</ul>
<h5 id="5-xxl-job"><a class="toclink" href="../../xxx-job/#5-xxl-job">第5集 新版分布式调度XXl-Job源码部署和数据库表建立《下》</a></h5>
<p><strong>简介：新版分布式调度XXl-Job源码部署和数据库表建立《下》</strong></p>
<ul>
<li>
<p>部署XXL-Job步骤</p>
</li>
<li>
<p>xxl-job-admin目录配置文件 application.properties</p>
<ul>
<li>配置数据库连接</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>### xxl-job, datasource
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>spring.datasource.url=jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>spring.datasource.username=root
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>spring.datasource.password=xdclass.net
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
</span></code></pre></div>
<ul>
<li>配置 xxl.job.accessToken（后续要配置客户端接入配置token）</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>xxl.job.accessToken=xdclass.net
</span></code></pre></div>
</li>
<li>
<p>构建编译：mvn install</p>
</li>
<li>
<p>启动项目</p>
</li>
<li>
<p>注意</p>
</li>
<li>
<p>网络部署属于CS架构，需要双方网络互通</p>
</li>
<li>
<p>Mac电脑启动报错</p>
</li>
<li>
<p>访问地址</p>
</li>
<li>地址：ip:8080/xxl-job-admin</li>
<li>默认账号密码：admin / 123456</li>
</ul>
<h5 id="6-xxl-job-ui"><a class="toclink" href="../../xxx-job/#6-xxl-job-ui">第6集 分布式调度XXL-Job UI菜单模块介绍</a></h5>
<p><strong>简介：分布式调度XXL-Job UI界面介绍</strong></p>
<ul>
<li>运行报表</li>
<li>
<p>以图形化来展示了整体的任务执行情况</p>
<ul>
<li>任务数量：能够看到调度中心运行的任务数量</li>
<li>调度次数：调度中心所触发的调度次数</li>
<li>执行器数量：在整个调度中心中，在线的执行器数量有多少</li>
</ul>
</li>
<li>
<p>任务管理（配置执行任务）</p>
</li>
<li>示例执行器：所用到的执行器</li>
<li>任务描述：概述该任务是做什么的</li>
<li>路由策略：<ul>
<li>第一个：选择第一个机器</li>
<li>最后一个：选择最后一个机器</li>
<li>轮询：依次选择执行</li>
<li>随机：随机选择在线的机器</li>
<li>一致性HASH：每个任务按照Hash算法固定选择某一台机器，并且所有的任务均匀散列在不同的机器上</li>
<li>最不经常使用：使用频率最低的机器优先被使用</li>
<li>最近最久未使用：最久未使用的机器优先被选举</li>
<li>故障转移：按照顺序依次进行心跳检测，第一个心跳检测成功的机器选定为目标的执行器并且会发起任务调度</li>
<li>忙碌转移：按照顺序来依次进行空闲检测，第一个空闲检测成功的机器会被选定为目标群机器，并且会发起任务调度</li>
<li>分片广播：广播触发对于集群中的所有机器执行任务，同时会系统会自动传递分片的参数</li>
</ul>
</li>
<li>Cron：执行规则 </li>
<li>调度过期策略：调度中心错过调度时间的补偿处理策略，包括：忽略、立即补偿触发一次等</li>
<li>JobHandler：定义执行器的名字</li>
<li>阻塞处理策略：<ul>
<li>单机串行：新的调度任务在进入到执行器之后，该调度任务进入FIFO队列，并以串行的方式去进行</li>
<li>丢弃后续调度：新的调度任务在进入到执行器之后，如果存在相同的且正在运行的调度任务，本次的调度任务请求就会被丢弃掉，并且标记为失败</li>
<li>覆盖之前的调度：新的调度任务在进入到执行器之后，如果存在相同的且正在运行的调度任务，就会终止掉当前正在运行的调度任务，并且清空队列，运行新的调度任务。</li>
</ul>
</li>
<li>子任务ID：输入子任务的任务id，可填写多个</li>
<li>任务超时时间：添加任务超时的时候，单位s，设置时间大于0的时候就会生效</li>
<li>失败重试次数：设置失败重试的次数，设置时间大于0的时候就会生效</li>
<li>负责人：填写该任务调度的负责人</li>
<li>
<p>报警邮件：出现报警，则发送邮件</p>
</li>
<li>
<p>调度日志</p>
</li>
<li>这里是查看调度的日志，根据日志来查看任务具体的执行情况是怎样的</li>
<li>执行器管理</li>
<li>这里是配置执行器，等待执行器启动的时候都会被调度中心监听加入到地址列表</li>
<li>用户管理</li>
<li>可以对用户的一些操作</li>
</ul>
<h4 id="springbootxxl-job"><a class="toclink" href="../../xxx-job/#springbootxxl-job">第三章 新版SpringBoot整合XXL-Job分布式调度任务实操</a></h4>
<h5 id="1-springbootxxl-job"><a class="toclink" href="../../xxx-job/#1-springbootxxl-job">第1集 新版Springboot整合XXL-Job项目搭建</a></h5>
<p><strong>简介：新版Springboot整合XXL-Job项目搭建</strong></p>
<ul>
<li>新版Springboot介绍</li>
<li>GitHub地址：https://github.com/spring-projects/spring-boot</li>
<li>官方文档：https://spring.io/guides/gs/spring-boot/</li>
<li>视频地址：https://item.taobao.com/item.htm?id=618384570391</li>
<li>在线创建：https://start.spring.io/</li>
<li>相关的软件环境</li>
<li>jdk8/11+maven3.5</li>
<li>编辑器IDEA</li>
<li>创建一个Springboot项目</li>
<li>
<p>导入本集课程代码即可，pom版本保持一致</p>
</li>
<li>
<p>添加XXL-Job依赖</p>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>         &lt;dependency&gt;
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>            &lt;groupId&gt;com.xuxueli&lt;/groupId&gt;
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>            &lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt;
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>            &lt;version&gt;2.3.0&lt;/version&gt;
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>        &lt;/dependency&gt;
</span></code></pre></div>
<ul>
<li>
<p>编写简单的任务调度例子</p>
</li>
<li>
<p>新增logback.xml</p>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>&lt;configuration debug=&quot;false&quot; scan=&quot;true&quot; scanPeriod=&quot;1 seconds&quot;&gt;
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    &lt;contextName&gt;logback&lt;/contextName&gt;
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    &lt;property name=&quot;log.path&quot; value=&quot;./data/logs/xxl-job/app.log&quot;/&gt;
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>        &lt;encoder&gt;
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>            &lt;pattern&gt;%d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>        &lt;/encoder&gt;
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    &lt;/appender&gt;
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    &lt;appender name=&quot;file&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>        &lt;file&gt;${log.path}&lt;/file&gt;
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>            &lt;fileNamePattern&gt;${log.path}.%d{yyyy-MM-dd}.zip&lt;/fileNamePattern&gt;
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        &lt;/rollingPolicy&gt;
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        &lt;encoder&gt;
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>            &lt;pattern&gt;%date %level [%thread] %logger{36} [%file : %line] %msg%n
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>            &lt;/pattern&gt;
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>        &lt;/encoder&gt;
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    &lt;/appender&gt;
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>    &lt;root level=&quot;info&quot;&gt;
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>        &lt;appender-ref ref=&quot;console&quot;/&gt;
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>        &lt;appender-ref ref=&quot;file&quot;/&gt;
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>    &lt;/root&gt;
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>&lt;/configuration&gt;
</span></code></pre></div>
<ul>
<li>配置文件</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>#----------xxl-job配置--------------
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>logging.config=classpath:logback.xml
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>#调度中心部署地址,多个配置逗号分隔 &quot;http://address01,http://address02&quot;
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>#执行器token，非空时启用 xxl-job, access token 
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>xxl.job.accessToken=xdclass.net
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a># 执行器app名称,和控制台那边配置一样的名称，不然注册不上去
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>xxl.job.executor.appname=xdclass-shop
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a># [选填]执行器注册：优先使用该配置作为注册地址，为空时使用内嵌服务 ”IP:PORT“ 作为注册地址。
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>#从而更灵活的支持容器类型执行器动态IP和动态映射端口问题。
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>xxl.job.executor.address=
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>#[选填]执行器IP ：默认为空表示自动获取IP（即springboot容器的ip和端口，可以自动获取，也可以指定），多网卡时可手动设置指定IP，该IP不会绑定Host仅作为通讯实用；地址信息用于 &quot;执行器注册&quot; 和 &quot;调度中心请求并触发任务&quot;，
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>xxl.job.executor.ip=
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a># [选填]执行器端口号：小于等于0则自动获取；默认端口为9999，单机部署多个执行器时，注意要配置不同执行器端口；
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>xxl.job.executor.port=9999
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>#执行器日志文件存储路径，需要对该路径拥有读写权限；为空则使用默认路径
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>xxl.job.executor.logpath=./data/logs/xxl-job/executor
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>#执行器日志保存天数
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>xxl.job.executor.logretentiondays=30
</span></code></pre></div>
<ul>
<li>XxlJobConfig</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>@Configuration
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>public class XxlJobConfig {
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    private Logger log = LoggerFactory.getLogger(XxlJobConfig.class);
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    @Value(&quot;${xxl.job.admin.addresses}&quot;)
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    private String adminAddresses;
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    @Value(&quot;${xxl.job.executor.appname}&quot;)
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    private String appName;
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    @Value(&quot;${xxl.job.executor.ip}&quot;)
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    private String ip;
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    @Value(&quot;${xxl.job.executor.port}&quot;)
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    private int port;
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>    @Value(&quot;${xxl.job.accessToken}&quot;)
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>    private String accessToken;
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>    @Value(&quot;${xxl.job.executor.logpath}&quot;)
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>    private String logPath;
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>    @Value(&quot;${xxl.job.executor.logretentiondays}&quot;)
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>    private int logRetentionDays;
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>    //旧版的有bug
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>    //@Bean(initMethod = &quot;start&quot;, destroyMethod = &quot;destroy&quot;)
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>    @Bean
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>    public XxlJobSpringExecutor xxlJobExecutor() {
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>        log.info(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.&quot;);
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>        XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor();
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>        xxlJobSpringExecutor.setAdminAddresses(adminAddresses);
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>        xxlJobSpringExecutor.setAppname(appName);
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>        xxlJobSpringExecutor.setIp(ip);
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>        xxlJobSpringExecutor.setPort(port);
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>        xxlJobSpringExecutor.setAccessToken(accessToken);
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>        xxlJobSpringExecutor.setLogPath(logPath);
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>        xxlJobSpringExecutor.setLogRetentionDays(logRetentionDays);
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>        return xxlJobSpringExecutor;
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>    }
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>}
</span></code></pre></div>
<h5 id="2-xxl-job"><a class="toclink" href="../../xxx-job/#2-xxl-job">第2集 创建你的第一个XXL-Job分布式调度任务</a></h5>
<p><strong>简介：创建你的第一个XXL-Job分布式调度任务</strong></p>
<ul>
<li>
<p>注解介绍</p>
</li>
<li>
<p>在 Spring Bean 实例中，开发 Job 方法方式格式要求为</p>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>public ReturnT&lt;String&gt; execute(String param)
</span></code></pre></div>
<ul>
<li>为 Job 方法添加注解 （注解value值是调度中心新建任务的 JobHandler 属性的值）</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>@XxlJob(value=&quot;自定义jobHandler名称&quot;, init = &quot;handler初始化方法&quot;, destroy = &quot;handler 销毁方法&quot;)
</span></code></pre></div>
<ul>
<li>编写代码</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>@Component
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>public class MyJobHandler {
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    private Logger log = LoggerFactory.getLogger(MyJobHandler.class);
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    @XxlJob(value = &quot;demoJobHandler&quot;,init = &quot;init&quot;,destroy = &quot;destroy&quot;)
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    public ReturnT&lt;String&gt; execute(String param){
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        log.info(&quot;小滴课堂 execute 任务方法触发成功&quot;);
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>        return ReturnT.SUCCESS;
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    }
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    private void init(){
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>        log.info(&quot;小滴课堂 MyJobHandler init &gt;&gt;&gt;&gt;&gt;&quot;);
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    }
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    private void destroy(){
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>        log.info(&quot;小滴课堂 MyJobHandler destroy &gt;&gt;&gt;&gt;&gt;&quot;);
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>    }
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>}
</span></code></pre></div>
<ul>
<li>执行器管理</li>
<li>
<p>到xxl-job调度中心里的执行器管理-&gt;新增</p>
<ul>
<li>Appname：是每一个执行器的唯一表示AppName，执行器会以周期性为appname进行注册，为任务调度的时候使用</li>
<li>名称：执行器的名称，因为appname有限制字母与数字等等组成，可读性不强，这个名称就是为了提高执行器的可读性</li>
<li>注册方式：调度中心获取执行器地址的方式</li>
<li>自动注册：执行器自动进行执行器的注册，通过底层的注册表可以动态的发现执行器机器的地址</li>
<li>手动录入：人工手动录入执行器的地址信息，多地址使用逗号进行分割，供调度中心使用</li>
<li>机器地址：“注册方式”为手动录入的时候才能使用，支持人工维护执行器的地址</li>
<li>点击保存后可能要等30S左右才回显示机器的地址</li>
</ul>
</li>
<li>
<p>任务管理</p>
</li>
<li>任务管理-&gt;选择所需要管理的执行器-&gt;新增执行器</li>
</ul>
<h5 id="3-xxl-job_1"><a class="toclink" href="../../xxx-job/#3-xxl-job_1">第3集 执行和分析第一个XXL-Job分布式调度任务</a></h5>
<p><strong>简介：执行和分析第一个XXL-Job分布式调度任务</strong></p>
<ul>
<li>
<p>任务管理-启动任务</p>
</li>
<li>
<p>任务管理的状态已经从STOP变更成RUNNING</p>
</li>
<li>
<p>调度日志</p>
</li>
<li>
<p>在调度日志里能够查看调度结果与日志的信息</p>
</li>
</ul>
<h5 id="4-executor"><a class="toclink" href="../../xxx-job/#4-executor">第4集 Executor执行器多节点部署和调度策略讲解实战</a></h5>
<p><strong>简介：执行器多节点部署和调度策略讲解实战</strong></p>
<ul>
<li>本机部署多节点</li>
<li>程序端口修改</li>
<li>
<p>执行器端口修改</p>
</li>
<li>
<p>策略</p>
</li>
<li>第一个、最后一个、轮训</li>
</ul>
<p><strong>更多架构课程请访问 xdclass.net</strong></p>
<h4 id="xxl-job_1"><a class="toclink" href="../../xxx-job/#xxl-job_1">第四章 【进阶】XXL-Job分布式调度多案例实战</a></h4>
<h5 id="1_1"><a class="toclink" href="../../xxx-job/#1_1">第1集 分布式调度参数传递和调度日志配置</a></h5>
<p><strong>简介：分布式调度参数传递和调度日志配置讲解</strong></p>
<ul>
<li>UI界面参数传递</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>String jobParam = XxlJobHelper.getJobParam();
</span></code></pre></div>
<ul>
<li>执行日志打印</li>
<li>
<p>需要通过 "XxlJobHelper.log" 打印执行日志</p>
</li>
<li>
<p>执行结果</p>
</li>
<li>默认任务结果为 "成功" 状态，不需要主动设置</li>
<li>自主设置任务结果（会出现在【执行备注】里面）<ul>
<li>如想设置任务结果为失败，可以通过 "XxlJobHelper.handleFail</li>
<li>如想设置任务结果为成功，handleSuccess" </li>
</ul>
</li>
</ul>
<h5 id="2-xxl-job_1"><a class="toclink" href="../../xxx-job/#2-xxl-job_1">第2集 【高级】XXL-Job集群部署和高可用案例配置</a></h5>
<p><strong>简介：【高级】XXL-Job集群部署和高可用案例讲解</strong></p>
<ul>
<li>
<p>HA/集群</p>
</li>
<li>
<p>为了避免单点故障，任务调度系统通常需要通过集群实现系统高可用</p>
</li>
<li>
<p>由于任务调度系统的特殊性，“调度”和“任务”两个模块需要均支持集群部署，由于职责不同，因此各自集群侧重点也有有所不同。</p>
</li>
<li>
<p>调度中心集群</p>
<ul>
<li>目标为避免调度模块单点故障，集群节点需要通过锁或命名服务保证单个任务的单次触发，只在其中一个节点上生效，以防止任务的重复触发。</li>
</ul>
</li>
<li>
<p>执行器集群</p>
<ul>
<li>目标为避免任务模块单点故障，进一步可以通过自定义路由策略实现Failover等高级功能，从而在执行器某台机器节点故障时自动转移不会影响到任务的正常触发执行</li>
</ul>
</li>
<li>
<p>高可用集群架构</p>
</li>
<li>
<p>执行器配置调度中心集群</p>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>#调度中心部署地址,多个配置逗号分隔 &quot;http://address01,http://address02&quot;
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin,http://127.0.0.1:8079/xxl-job-admin
</span></code></pre></div>
<h5 id="3-xxl-job-"><a class="toclink" href="../../xxx-job/#3-xxl-job-">第3集 【高级】XXL-Job海量数据处理-分片任务实战《上》</a></h5>
<p><strong>简介：XXL-Job海量数据处理-分片任务实战《上》</strong></p>
<ul>
<li>
<p>需求</p>
</li>
<li>
<p>有一个任务需要处理100W条数据，每条数据的业务逻辑处理要0.1s</p>
</li>
<li>对于普通任务来说，只有一个线程来处理 可能需要10万秒才能处理完，业务则严重受影响</li>
<li>
<p>案例：双十一大促，给1000万用户发营销短信</p>
</li>
<li>
<p>什么是分片任务</p>
</li>
<li>
<p>执行器集群部署，如果任务的路由策略选择【分片广播】，一次任务调度将会【广播触发】对应集群中所有执行器执行一次任务，同时系统自动传递分片参数，执行器可根据分片参数开发分片任务</p>
</li>
<li>需要处理的海量数据，以执行器为划分，每个执行器分配一定的任务数，并行执行</li>
<li>XXL-Job支持动态扩容执行器集群，从而动态增加分片数量，到达更快处理任务</li>
<li>分片的值是调度中心分配的</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>// 当前分片数，从0开始，即执行器的序号
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>int shardIndex = XxlJobHelper.getShardIndex();
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>//总分片数，执行器集群总机器数量
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>int shardTotal = XxlJobHelper.getShardTotal();
</span></code></pre></div>
<ul>
<li>
<p>解决思路</p>
</li>
<li>
<p>如果将100W数据均匀分给集群里的10台机器同时处理，</p>
</li>
<li>每台机器耗时，1万秒即可，耗时会大大缩短，也能充分利用集群资源</li>
<li>
<p>在xxl-job里，可以配置执行器集群有10个机器，那么分片总数是10，分片序号0~9 分别对应那10台机器。</p>
</li>
<li>
<p>分片方式</p>
<ul>
<li>id % 分片总数 余数是0 的，在第1个执行器上执行</li>
<li>id % 分片总数 余数是1 的，在第2个执行器上执行</li>
<li>id % 分片总数 余数是2 的，在第3个执行器上执行</li>
<li>...</li>
<li>id % 分片总数 余数是9 的，在第10个执行器上执行</li>
</ul>
</li>
<li>
<p>路由策略</p>
<ul>
<li>选择为【分片广播】</li>
</ul>
</li>
<li>
<p>其他解决方式</p>
<ul>
<li>也可以启动多个job，使用同个jobHandler,通过命令行参数控制</li>
</ul>
</li>
</ul>
<h5 id="4-xxl-job-"><a class="toclink" href="../../xxx-job/#4-xxl-job-">第4集 【高级】XXL-Job海量数据处理-分片任务实战《下》</a></h5>
<p><strong>简介：XXL-Job海量数据处理-分片任务实战《上》</strong></p>
<ul>
<li>
<p>编码实战</p>
</li>
<li>
<p>需求：100个用户，分片处理</p>
</li>
<li>新增job测试案例</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>   /**
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>     * 2、分片广播任务
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>     */
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    @XxlJob(&quot;shardingJobHandler&quot;)
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    public void shardingJobHandler() throws Exception {
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>        // 当前分片数，从0开始，即执行器的序号
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>        int shardIndex = XxlJobHelper.getShardIndex();
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>        //总分片数，执行器集群总机器数量
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>        int shardTotal = XxlJobHelper.getShardTotal();
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>        XxlJobHelper.log(&quot;分片参数：当前分片序号 = {}, 总分片数 = {}&quot;, shardIndex, shardTotal);
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>        // 业务逻辑
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>        for (int i = 0; i &lt; shardTotal; i++) {
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>            if (i == shardIndex) {
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>                log.info(&quot;第 {} 片, 命中分片开始处理&quot;, i);
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>            } else {
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>                log.info(&quot;第 {} 片, 忽略&quot;, i);
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>            }
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>        }
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>    }
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>* 根据id进行分片取模（部署3个执行器）
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>    /**
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>     * 2、分片广播任务
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>     */
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    @XxlJob(&quot;shardingJobHandler&quot;)
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    public void shardingJobHandler() throws Exception {
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>        // 当前分片数，从0开始，即执行器的序号
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>        int shardIndex = XxlJobHelper.getShardIndex();
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>        //总分片数，执行器集群总机器数量
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>        int shardTotal = XxlJobHelper.getShardTotal();
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>        XxlJobHelper.log(&quot;分片参数：当前分片序号 = {}, 总分片数 = {}&quot;, shardIndex, shardTotal);
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>        List&lt;Integer&gt; allUserIds = getAllUserIds();
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>        allUserIds.forEach(obj -&gt; {
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>            if (obj % shardTotal == shardIndex) {
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>                log.info(&quot;第 {} 片, 命中分片开始处理用户id={}&quot;,shardIndex,obj);
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>            }
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>        });
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>    }
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>    private List&lt;Integer&gt; getAllUserIds() {
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>        List&lt;Integer&gt; ids = new ArrayList&lt;&gt;();
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>        for (int i = 0; i &lt; 100; i++) {
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>            ids.add(i);
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>        }
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>        return ids;
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>    }
</span></code></pre></div>
<h5 id="5-"><a class="toclink" href="../../xxx-job/#5-">第5集 留给大家的作业-海量任务定时调度-处理维护三连问</a></h5>
<p><strong>简介： 留给大家的作业-海量任务定时调度-处理维护三连问</strong></p>
<ul>
<li>
<p>需求背景</p>
</li>
<li>
<p>为了促进平台用户活跃度，鼓励用户每天登录网站</p>
</li>
<li>
<p>短链平台，每天可以免费创建2次短链，每天限制次数</p>
<ul>
<li>用户量：千万级别、甚至亿级别</li>
<li>每个用户【每天】可以免费进行2次使用平台功能【免费流量包】</li>
<li>如果用户超过2次还想使用平台功能，则可以付费购买流量包，增加每天次数【付费流量包】</li>
</ul>
</li>
<li>
<p>正式案例</p>
<ul>
<li>百度云短链平台：https://dwz.cn/console/product</li>
</ul>
</li>
<li>
<p>如何维护好用户每天的免费权益次数呢 ？？？</p>
</li>
<li>
<p>怎么维护更新好流量包每天的次数呢</p>
</li>
<li>
<p>留给老王的作业，海量数据项目大课里面的核心内容</p>
</li>
<li>
<p>分片广播任务</p>
</li>
<li>
<p>惰性更新+定时更新</p>
</li>
<li>
<p>业务模型适合场景</p>
</li>
<li>
<p>拼多多用户签到，总签到次数达到一定数值后，免费领取商品，每天限制次数</p>
</li>
<li>
<p>信用卡每天领取积分，每天限制次数</p>
</li>
<li>
<p>电商平台抽奖，每天免费抽奖两次，每天限制次数</p>
</li>
</ul>
<h5 id="6-xxl-job"><a class="toclink" href="../../xxx-job/#6-xxl-job">第6集 学完分布式调度XXL-Job后你的下一步</a></h5>
<p><strong>简介： 学完分布式调度XXL-Job后你的下一步</strong></p>
<h4 id="xxl-job_2"><a class="toclink" href="../../xxx-job/#xxl-job_2">第五章 分布式调度XXL-Job课程总结和学习建议</a></h4>
<h5 id="1-xxl-job"><a class="toclink" href="../../xxx-job/#1-xxl-job">第1集  分布式调度XXL-Job课程总结</a></h5>
<p><strong>简介： 分布式调度XXL-Job课程总结</strong></p>
<ul>
<li>知识点回顾</li>
<li>需求背景</li>
<li>同类解决方案</li>
<li>XXL-Job部署架构</li>
<li>SpringBoot项目整合</li>
<li>多节点部署和调度策略</li>
<li>控制台日志配置</li>
<li>高可用案例</li>
<li>分片任务实战</li>
</ul>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/saymealoud.png" alt="Chester Zhao">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-01-31 00:00:00">January 31, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/word1/" class="md-meta__link">word1</a></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="hello-world"><a class="toclink" href="../../hello-world/">Hello world!</a></h2>
<p>Material for MkDocs is a powerful documentation framework on top of MkDocs, a static site generator for project documentation.1 If you're familiar with Python, you can install Material for MkDocs with pip, the Python package manager. If not, we recommend using docker.</p>

    
      <nav class="md-post__action">
        <a href="../../hello-world/">
          Continue reading
        </a>
      </nav>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.sections", "navigation.instant"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>